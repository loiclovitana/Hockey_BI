#!/bin/bash

# Deployment script for Hockey BI frontend
# Usage: ./deploy [TARGET_DIR] [ENV_FILE]
# Example: ./deploy /var/www/html .env.production

dir_script=$(dirname $(realpath "$0"))
set -e

# Default values
DEFAULT_TARGET_DIR="/var/www/hockey"

# Parse arguments
TARGET_DIR=${1:-$DEFAULT_TARGET_DIR}

# SSH connection details
SSH_TARGET="aml"

echo "=ï¿½ Starting deployment..."
echo "=ï¿½ Target directory: $TARGET_DIR"



# Navigate to frontend directory
if [ ! -d "$dir_script/frontend" ]; then
    echo "L Frontend directory not found!"
    exit 1
fi

cd "$dir_script/frontend"

echo "=ï¿½ Installing dependencies..."
npm install

echo "<ï¿½  Building frontend for production env"

npm run build -- --mode production 

echo "=ï¿½ Copying build to remote server..."
scp -r dist/* $SSH_TARGET:$TARGET_DIR/


echo " Deployment completed successfully!"
echo "< Frontend deployed to $SSH_TARGET:$TARGET_DIR"